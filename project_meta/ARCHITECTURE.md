# Модульная Архитектура pdf2video

Проект разделен на независимые пакеты (artifacts), что позволяет разработчикам работать над разными частями системы без конфликтов.

## Структура пакетов

### 1. `internal/config`
**Область:** Контракт данных.
**Файлы:** `config.go`
**Описание:** Содержит структуры `Config` и `SegmentParams`. Это "общий язык", на котором общаются все остальные модули.

### 2. `internal/source`
**Область:** Работа с медиа-ресурсами.
**Файлы:** `source.go`, `image.go`
**Описание:** Реализует интерфейс `Source`. Поддерживает PDF (через `go-fitz`) и наборы изображений (JPG/PNG).
**Зачем:** Унифицирует доступ к визуальному контенту. Можно легко добавить поддержку новых форматов (PPTX, видео-футажи).

### 3. `internal/video`
**Область:** Видео-инфраструктура.
**Файлы:** `video.go`
**Описание:** Управляет вызовами FFmpeg. Реализует `VideoEncoder`. 
**Зачем:** Здесь настраивается аппаратное ускорение, параметры кодеков и логика склейки (xfade). 
**Robustness:** Использует `-filter_script` для передачи сложных цепочек фильтров через временные файлы, обходя лимиты ОС.

### 4. `internal/renderer`
**Область:** Генерация выражений.
**Файлы:** `ffmpeg_filter.go`
**Описание:** Чистая логика построения математических выражений для фильтров.
**Оптимизация:** Реализует $O(N)$ построение кусочно-линейных функций для плавного движения камеры.

### 5. `internal/effects`
**Область:** Визуальная логика.
**Файлы:** `effects.go`, `scenario_effect.go`
**Описание:** Генерирует сложные фильтры для FFmpeg (Ken Burns, Breathing Zoom). 
**Зачем:** Позволяет добавлять новые типы анимаций, просто создавая новые реализации интерфейса `Effect`.

### 6. `internal/engine`
**Область:** Оркестрация (Мозг).
**Файлы:** `engine.go`
**Описание:** Соединяет все модули вместе через интерфейсы. Управляет Worker Pool'ом, временными файлами и логикой расчета длительности клипов.
**Debug Rendering:** Рисует отладочные рамки траектории камеры (`Scenario Tracking`) на Go-стороне перед отправкой кадров в FFmpeg.

### 6. `internal/analyzer`
**Область:** Компьютерное зрение.
**Файлы:** `detector.go`, `contrast.go`
**Описание:** Анализирует изображения для поиска "областей интереса" (ROI). Использует алгоритмы детекции границ для определения структуры слайда.

### 7. `internal/director`
**Область:** Режиссура и Сценарии.
**Файлы:** `director.go`, `scenario.go`
**Описание:** Превращает результаты анализа в логические сценарии движения камеры. Управляет сериализацией/десериализацией YAML.

### 8. `internal/system`
**Область:** Системный уровень.
**Файлы:** `system.go`
**Описание:** Утилиты для работы с ОС (лимиты файлов, поиск медиа в папках, получение длительности аудио).

## Порядок работы для команды
1. **Интерфейсы превыше всего:** Если вам нужно передать новые данные, сначала обновите `internal/config`.
2. **Изоляция:** Не импортируйте `pdf` в `video`. Все связи должны идти через интерфейсы в `engine`.
3. **Запуск:** Точка входа находится в `cmd/pdf2video/main.go`.
